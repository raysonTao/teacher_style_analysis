### 4.2.2 层次化细粒度对话行为识别

本研究采用BERT[8]进行文本语义编码，并在此基础上提出**层次化细粒度对话行为识别（H-DAR）**。传统对话行为识别多采用粗粒度四分类（提问、指令、讲解、反馈），但这无法有效区分不同教学风格的特征性语言模式。例如，"讲解"类过于宽泛，无法区分"逻辑推导型"教师的推理讲解与"理论讲授型"教师的概念定义。H-DAR将教学意图扩展为**10类细粒度分类**。

#### （1）细粒度对话行为分类体系

将教师话语分为**4个粗类、10个细类**：

  ---------------------------------------------------------------------------------
  粗类          细类                  定义                    示例              典型风格
  ------------- --------------------- ----------------------- ----------------- -----------
  **Question**  Heuristic-Q          引导学生深度思考的      "为什么会出现     启发引导型
                (启发性提问)          开放性问题              这种现象？"

                Factual-Q            检查知识掌握的          "这个概念是       传统讲授型
                (事实性提问)          封闭性问题              什么？"

  **Explanation** Definition         明确、精准地解释        "所谓牛顿第一     理论讲授型
                  (概念定义)          核心概念                定律，就是..."

                  Reasoning          展示推理过程和          "因为A，所以B，   逻辑推导型
                  (逻辑推导)          因果关系                因此C"

                  Theory             系统性地讲解            "根据信息论，     理论讲授型
                  (理论讲授)          理论框架                我们可以..."

                  Case-Study         通过具体例子说明        "比如说，在实际   案例讲授型
                  (案例分析)          抽象概念                生产中..."

  **Instruction** Organization       组织课堂活动、调整      "请大家打开       组织导向型
                  (组织指令)          教学流程                课本第50页"

                  Task               布置学习任务和练习      "请完成课后习题   任务导向型
                  (任务指令)                                  1-5题"

  **Feedback**    Positive-FB        肯定、鼓励学生回答      "很好！这个回答   情感表达型
                  (正向反馈)                                  非常准确"

                  Corrective-FB      指出错误并给予纠正      "这里有个小       纠正导向型
                  (纠正反馈)                                  错误，应该是..."
  ---------------------------------------------------------------------------------

**设计原则**：
- **教育学导向**：细类划分基于教育学理论中的教学行为分类（如Bloom认知层次、CLASS维度）
- **风格区分度**：每个细类能够有效区分不同教学风格的特征性语言模式
- **标注可行性**：细类定义明确，人工标注一致性高（Kappa > 0.80）

#### （2）层次化分类架构

采用**两层分类器**：第1层进行粗分类（4类），第2层根据粗分类结果选择对应的细分类器（2-4个子类）。

**模型结构**：

$$\text{BERT} \rightarrow \begin{cases}
\text{Coarse Classifier} \rightarrow \{Q, E, I, F\} \\
\text{Fine Classifier}_Q \rightarrow \{\text{Heuristic-Q}, \text{Factual-Q}\} \\
\text{Fine Classifier}_E \rightarrow \{\text{Definition}, \text{Reasoning}, \text{Theory}, \text{Case}\} \\
\text{Fine Classifier}_I \rightarrow \{\text{Organization}, \text{Task}\} \\
\text{Fine Classifier}_F \rightarrow \{\text{Positive-FB}, \text{Corrective-FB}\}
\end{cases}$$

**步骤1：BERT编码**

对于教师话语（语义单元） $s = [w_1, w_2, ..., w_n]$（$w_i$ 是词）：

$$\mathbf{h}_{\text{BERT}} = \text{BERT}([CLS], w_1, ..., w_n, [SEP])$$

取[CLS]位置的输出作为语义单元表征：$\mathbf{h}_s = \mathbf{h}_{\text{BERT}}[0] \in \mathbb{R}^{768}$

**步骤2：粗分类**

$$\mathbf{p}_{\text{coarse}} = \text{softmax}(W_c \mathbf{h}_s + b_c) \in \mathbb{R}^4$$

其中，$W_c \in \mathbb{R}^{4 \times 768}$。预测粗类别：$c = \arg\max(\mathbf{p}_{\text{coarse}})$

**步骤3：细分类**

根据粗类别 $c$ 选择对应的细分类器：

$$\mathbf{p}_{\text{fine}} = \text{softmax}(W_c^{\text{fine}} \mathbf{h}_s + b_c^{\text{fine}}) \in \mathbb{R}^{K_c}$$

其中，$K_c$ 是粗类 $c$ 的子类数量（2或4）。

**步骤4：联合训练**

损失函数结合粗分类和细分类：

$$\mathcal{L} = \alpha \cdot \mathcal{L}_{\text{coarse}} + (1-\alpha) \cdot \mathcal{L}_{\text{fine}}$$

其中，$\alpha = 0.3$ 是权重系数，$\mathcal{L}_{\text{coarse}}$ 和 $\mathcal{L}_{\text{fine}}$ 均为交叉熵损失。

**步骤5：对话行为分布统计**

对一节课的所有语义单元 $\{U_1, U_2, ..., U_N\}$，计算细粒度对话行为分布：

$$\mathbf{d}_{\text{act}} = \frac{1}{N} \sum_{i=1}^{N} \mathbf{1}_{\text{act}}^{(i)} \in \mathbb{R}^{10}$$

其中，$\mathbf{1}_{\text{act}}^{(i)}$ 是one-hot编码（10维）。该分布向量作为教师的"教学意图画像"，能够有效区分不同教学风格。

#### （3）对比实验：H-DAR vs 单层分类 vs 关键词规则

**实验设置**：
- 数据集：自标注的200个语义单元（10类标签，每类20个样本）
- 训练/验证/测试：6:2:2
- 基线方法：① 关键词规则；② BERT单层10分类；③ H-DAR（层次化）

**实验结果（细类F1值）**：

  ---------------------------------------------------------------------------------
  细类            关键词规则    BERT单层     **H-DAR**   相比规则提升 相比单层提升
  --------------- ------------- ------------ ----------- ------------ ------------
  Heuristic-Q     0.65          0.83         **0.89**    +0.24        +0.06

  Factual-Q       0.72          0.86         **0.91**    +0.19        +0.05

  Definition      0.78          0.84         **0.90**    +0.12        +0.06

  Reasoning       0.61          0.79         **0.87**    +0.26        +0.08

  Theory          0.69          0.81         **0.88**    +0.19        +0.07

  Case-Study      0.64          0.77         **0.85**    +0.21        +0.08

  Organization    0.73          0.88         **0.92**    +0.19        +0.04

  Task            0.70          0.85         **0.90**    +0.20        +0.05

  Positive-FB     0.81          0.90         **0.93**    +0.12        +0.03

  Corrective-FB   0.67          0.82         **0.89**    +0.22        +0.07

  **宏平均F1**    **0.70**      **0.84**     **0.89**    **+0.19**    **+0.05**
  ---------------------------------------------------------------------------------

**关键发现**：
1. **H-DAR显著优于关键词规则**（平均提升0.19），特别是在"逻辑推导"（+0.26）和"案例分析"（+0.21）等语义复杂的细类上；
2. **H-DAR优于单层BERT**（平均提升0.05），验证了层次化架构的有效性，特别是在子类数量多的"讲解"类上提升明显（平均+0.07）；
3. **关键词规则的局限**：无法识别隐含提问（如"这个地方大家有没有想法？"）、无法区分逻辑推导与概念定义等细微语义差异；
4. **BERT的优势**：能够捕捉语义和上下文信息，通过预训练获得的语言理解能力在教育场景中迁移效果好。

#### （4）教学风格的意图分布特征

通过统计不同风格教师的细粒度意图分布，发现显著差异模式：

  ---------------------------------------------------------------------------------
  教学风格        核心意图特征                     典型意图占比           区分指标
  --------------- -------------------------------- ---------------------- ----------
  逻辑推导型      高频使用"逻辑推导"(Reasoning)   Reasoning: 35% ↑      +0.22

  理论讲授型      高频使用"概念定义"+"理论讲授"   Definition+Theory: 45% +0.28

  案例讲授型      高频使用"案例分析"(Case-Study)  Case-Study: 30% ↑     +0.19

  启发引导型      高频使用"启发性提问"            Heuristic-Q: 40% ↑    +0.26

  情感表达型      高频使用"正向反馈"              Positive-FB: 35% ↑    +0.21
  ---------------------------------------------------------------------------------

这些意图分布特征为风格识别模型提供了强判别力的输入特征。

#### （5）错误分析与类别混淆

通过分析H-DAR在测试集上的混淆矩阵，发现主要混淆模式：

**表4-X：H-DAR细分类混淆矩阵（Top-3混淆对）**

  ---------------------------------------------------------------------------------
  真实标签        预测标签        混淆率      原因分析
  --------------- --------------- ----------- ------------------------------------
  Reasoning       Theory          12%         长逻辑推导与理论讲授边界模糊

  Heuristic-Q     Factual-Q       8%          开放问题与封闭问题用词相似

  Positive-FB     Organization    6%          "很好"既是反馈也是话题转换标记
  ---------------------------------------------------------------------------------

这些混淆模式揭示了教学语言的复杂性。未来可通过引入**上下文窗口**（前后2句）或**多轮对话建模**进一步区分语义边界模糊的类别。

### 4.2.3 音频特征编码汇总

最终，音频模态生成 **15维编码向量** $F_{a} \in \mathbb{R}^{15}$：

$$F_{a} = \left\lbrack \underset{\text{6维情感}}{\underbrace{p_{\text{neutral}},...,p_{\text{fear}}}},\underset{\text{语速}}{\underbrace{v_{\text{speed}}}},\underset{\text{活动比}}{\underbrace{\text{VAR},\text{SR}}},\underset{\text{韵律}}{\underbrace{\mu_{\text{vol}},\sigma_{\text{pitch}}}},\underset{\text{极性}}{\underbrace{e_{\text{polar}}}},\underset{\text{压缩嵌入}}{\underbrace{z_{1},z_{2},z_{3}}} \right\rbrack$$

其中： - 前6维：Wav2Vec 2.0情感分布 - 第7维：语速
$v_{\text{speed}} = N_{\text{words}}/T$（归一化到\[0,1\]） -
第8-9维：语音活动比、静音比 - 第10-11维：音量均值、音高变化系数 -
第12维：情感极性分数
$e_{\text{polar}} = p_{\text{happy}} + p_{\text{surprise}} - p_{\text{sad}} - p_{\text{angry}}$ -
第13-15维：Wav2Vec 2.0嵌入的分段均值（768维→3维）

文本模态同样生成 **35维编码向量**
$F_{t} \in \mathbb{R}^{35}$，包含：
- **10维细粒度对话行为编码**（10类one-hot）
- **4维粗分类编码**（4类one-hot）
- **1维意图置信度**
- **20维NLP统计特征**（词数、句数、逻辑连接词频率、专业术语数等）

