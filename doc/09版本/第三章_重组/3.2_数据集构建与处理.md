## 3.2 数据集构建与处理

### 3.2.1 数据采集流程

**硬件要求：**
- 视频：1280×720分辨率，25fps，H.264编码
- 音频：16kHz采样率，单声道，PCM编码
- 存储：每节课（40分钟）约占用500MB空间

**采集策略：**

1. 固定机位拍摄，确保教师活动区域完整入画
2. 使用定向麦克风采集教师语音，降低学生噪声干扰
3. 同步记录时间戳，精度达到毫秒级

**数据来源：**

本研究使用自建的教师风格数据集，数据来源包括：
- **mm-tba公开数据集**：多模态教学行为分析数据集
- **网络公开课堂视频**：从教育平台采集的课堂录像
- **合作学校录制**：与中学合作录制的真实课堂

### 3.2.2 数据预处理

#### （1）视频预处理

**视频解码与抽帧**

使用FFmpeg库解码视频流，按25fps提取RGB帧：

$$V = \{ v_{1},v_{2},...,v_{T}\},\quad v_{i} \in \mathbb{R}^{720 \times 1280 \times 3}$$

其中，$v_{i}$ 表示第 $i$ 帧的RGB像素矩阵。

**视频增强**

为提升模型鲁棒性，对训练数据应用以下增强策略：
- **随机裁剪**：以0.8-1.0的缩放比例裁剪
- **颜色抖动**：亮度、对比度、饱和度随机扰动（±20%）
- **时间抖动**：随机丢帧以模拟帧率不稳定

$$v_{i}\prime = \text{ColorJitter}\left( \text{RandomCrop}\left( v_{i},\text{scale} = 0.8 \right) \right)$$

**教师检测、追踪与姿态估计**

视频处理采用YOLOv8进行人体检测，DeepSORT算法进行教师身份追踪（ID稳定性提升25.5%），MediaPipe Pose提取33个骨骼关键点。DeepSORT通过结合外观特征（ReID）和运动模型（卡尔曼滤波）实现稳定追踪，基本消除了身份漂移问题。

姿态估计后保留置信度>0.5的关键点，缺失点通过线性插值补全。最终输出骨骼序列 $P \in \mathbb{R}^{T \times 33 \times 4}$（T帧，33关节点，每点包含x/y/z坐标和置信度），用于后续ST-GCN时序建模。

#### （2）音频预处理

**音频重采样与降噪**

将原始音频统一重采样到16kHz单声道，并应用谱减法（Spectral Subtraction）降噪：

$$S_{\text{clean}}(f) = max\left( \left| S_{\text{noisy}}(f) \right| - \alpha \cdot \left| N(f) \right|,\beta \cdot \left| S_{\text{noisy}}(f) \right| \right)$$

其中：
- $S_{\text{noisy}}(f)$ 是带噪语音的频谱
- $N(f)$ 是噪声频谱估计（从静音段提取）
- $\alpha = 2.0$ 是过减因子
- $\beta = 0.01$ 是谱下限

**语音活动检测（VAD）**

采用基于能量的VAD算法检测有效语音段。计算短时能量：

$$E(n) = \sum_{m = n - N + 1}^{n}\left| x(m) \right|^{2}$$

其中，$N$ 是窗口长度（通常取400个采样点，对应25ms）。

当 $E(n) > \theta_{\text{energy}}$ 时判定为语音帧，其中阈值 $\theta_{\text{energy}}$ 设为静音段能量均值的3倍：

$$\theta_{\text{energy}} = 3 \times \text{mean}\left( E_{\text{silence}} \right)$$

**统计特征提取**：
- **语音活动比**：$\text{VAR} = \frac{N_{\text{voice}}}{N_{\text{total}}}$
- **静音比**：$\text{SR} = 1 - \text{VAR}$
- **平均语速**：$\text{Speed} = \frac{N_{\text{words}}}{T_{\text{total}}}$（字/秒）

#### （3）文本预处理

**语音转文本（ASR）**

采用Whisper-medium模型进行语音识别，该模型支持中英混合识别：

$$T = \text{Whisper}(A)$$

其中，$A$ 是音频波形，$T$ 是转写文本。

**转写质量评估**：在测试集上字错率（CER）为8.7%：

$$\text{CER} = \frac{S + D + I}{N} \times 100\%$$

其中，$S,D,I$ 分别是替换、删除、插入错误数，$N$ 是总字符数。

**文本清洗**

对转写文本进行以下处理：

1. **去除语气词**：移除"嗯"、"啊"、"那个"等填充词
2. **句子分割**：按标点符号和停顿分割为句子
3. **错别字纠正**：使用拼音纠错模型（Pycorrector）

### 3.2.3 七类教学风格定义

基于教育学理论与课堂实地观察，本研究定义了七类具有区分力的教学风格：

| 风格类别 | 核心特征 | 典型行为模式 | 样本数量 |
|---------|---------|-------------|----------|
| **理论讲授型** | 系统化讲解理论框架，注重概念定义的准确性 | 高频使用"概念定义"和"理论讲授"话语，板书系统化 | 28 |
| **耐心细致型** | 语速慢、重复强调、关注细节 | 语速慢（<3字/秒），停顿多，情感平稳 | 32 |
| **启发引导型** | 通过提问引导学生思考，注重启发式教学 | 高频使用"启发性提问"（占比>40%），互动频繁 | 35 |
| **题目驱动型** | 以习题讲解为主，注重解题方法 | 板书频繁，指向黑板动作多，案例分析多 | 26 |
| **互动导向型** | 走动频繁，手势丰富，空间覆盖广 | 高频走动（>15次/10分钟），手势多样，眼神接触频繁 | 31 |
| **逻辑推导型** | 强调因果关系和推理过程 | 高频使用"因为...所以...因此"逻辑链（占比>35%） | 29 |
| **情感表达型** | 语调丰富，情感投入高，鼓励性语言多 | 情感极性分数高（>0.5），音频权重高（0.62） | 28 |

**设计原则**：
1. **教育学理论基础**：参考Flanders互动分析系统（FIAS）、CLASS课堂评估维度
2. **可观测性**：每类风格具有明确的行为特征，可通过视频、音频、文本观测
3. **区分度**：不同风格在多模态特征空间中具有显著差异（方差分析F=42.3, p<0.001）
4. **平衡性**：各类别样本数量在26-35之间，相对均衡

### 3.2.4 标注规范与质量控制

#### （1）标注流程

**三轮标注机制**：

1. **初标阶段**：由3名教育学专业研究生对每节课进行独立标注，根据3.2.3节的风格定义，为每节课打上1个主风格标签
2. **专家复核**：由2名具有10年以上教龄的学科专家对初标结果进行复核，对存在争议的样本进行讨论
3. **仲裁阶段**：对标注不一致的样本（初标者意见不统一），由资深教育专家进行最终仲裁

#### （2）标注一致性评估

**Fleiss' Kappa系数**：

对于多标注者的一致性评估，采用Fleiss' Kappa系数：

$$\kappa = \frac{\bar{P} - \bar{P}_e}{1 - \bar{P}_e}$$

其中：
- $\bar{P}$ 是观测一致性
- $\bar{P}_e$ 是期望一致性

**标注结果**：

- **初标阶段**：Fleiss' Kappa = 0.76（实质性一致）
- **专家复核后**：Fleiss' Kappa = 0.86（高度一致）
- **仲裁后最终标签**：作为模型训练的Ground Truth

#### （3）质量控制措施

1. **标注者培训**：
   - 组织2次集中培训，讲解七类风格的定义与典型案例
   - 提供10个标准样本进行练习标注，直至Kappa>0.75

2. **标注指南文档**：
   - 编写详细的《教师风格标注手册》，包含每类风格的特征列表、判断流程图、典型案例
   - 提供20个边界案例（如"启发引导型 vs 互动导向型"的区分）

3. **定期一致性检查**：
   - 每标注50个样本，重新标注10个已标注样本，检查标注者内部一致性（Intra-rater Reliability）
   - 标注者内部一致性Kappa均>0.82

4. **争议解决机制**：
   - 建立标注争议记录表，记录争议案例、分歧原因、最终决策
   - 通过争议案例分析，不断完善标注规范

#### （4）数据集统计

**表3.1：教师风格数据集统计**

| 项目 | 数值 |
|-----|------|
| 总样本数 | 209 |
| 总时长 | 156.7小时 |
| 平均每节课时长 | 45分钟 |
| 训练集 | 125（60%） |
| 验证集 | 31（15%） |
| 测试集 | 53（25%） |
| 标注一致性（Kappa） | 0.86 |
| 字错率（CER） | 8.7% |

**类别平衡性处理**：

由于各类别样本数量存在差异（26-35），训练时采用加权交叉熵损失处理类别不平衡：

$$\mathcal{L}_{\text{weighted}} = - \sum_{i = 1}^{N}{\sum_{k = 1}^{7}w_{k}} \cdot y_{i,k}\log\left( {\widehat{y}}_{i,k} \right)$$

其中，类别权重 $w_{k}$ 与样本数成反比：

$$w_{k} = \frac{N}{7 \cdot n_{k}}$$

$n_{k}$ 是类别 $k$ 的样本数，$N$ 是总样本数。
