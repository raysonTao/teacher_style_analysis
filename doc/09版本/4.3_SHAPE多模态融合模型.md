## 4.3 SHAPE多模态融合模型

这是本研究的核心创新，我们设计了**SHAPE (Semantic Hierarchical Attention Profiling Engine，语义层次化注意力画像引擎)**来实现特征的自适应融合与风格画像。SHAPE通过语义驱动分段、层次化教学意图识别和跨模态注意力机制，构建了从课堂录像到教师风格画像的���整流程。

### 4.3.1 设计动机

传统的多模态融合方法主要有三类：

**(1) 早期融合（Early Fusion）**：直接拼接原始特征

$$F_{\text{concat}} = \left\lbrack F_{v};F_{a};F_{t} \right\rbrack \in \mathbb{R}^{20 + 15 + 35} = \mathbb{R}^{70}$$

**局限性**： - 不同模态的维度和尺度差异大，高维模态会主导融合结果 -
无法建模模态间的交互关系 - 缺乏对不同模态重要性的自适应调整

**(2) 晚期融合（Late Fusion）**：分别训练单模态分类器，结果加权平均

$$P_{\text{final}} = w_{v}P_{v} + w_{a}P_{a} + w_{t}P_{t}$$

**局限性**： - 权重 $w_{v},w_{a},w_{t}$
固定，无法根据样本内容自适应调整 - 忽略了模态间的互补信息

**(3) 中间融合（Middle Fusion）**：在特征层进行加权融合

$$F_{\text{weighted}} = w_{v}F_{v} + w_{a}F_{a} + w_{t}F_{t}$$

**局限性**： - 仍然是固定权重 - 不同模态的特征空间不一致，直接相加不合理

采用**跨模态注意力机制**：

1\. 不同模态在不同样本上的重要性（样本自适应）

2\. 模态之间的交互关系（跨模态增强）

3\. 决策依据的可解释性（注意力权重可视化）

### 

### 4.3.1 （续）SHAPE网络架构 SHAPE网络架构

SHAPE由五个核心模块组成：

**【建议插入图3.2：SHAPE详细架构图】**

（图应包含：特征投影 → 跨模态注意力 → 时序建模 → 特征融合 → 分类器）

#### **模块1：特征投影层（Feature Projection Layer）**

由于三个模态的原始特征维度不同（$F_{v} \in \mathbb{R}^{20},F_{a} \in \mathbb{R}^{15},F_{t} \in \mathbb{R}^{35}$），首先通过全连接层投影到统一维度
$d = 512$：

$$F_{v}\prime = \text{ReLU}\left( W_{v}F_{v} + b_{v} \right),\quad F_{v}\prime \in \mathbb{R}^{512}$$

$$F_{a}\prime = \text{ReLU}\left( W_{a}F_{a} + b_{a} \right),\quad F_{a}\prime \in \mathbb{R}^{512}$$

$$F_{t}\prime = \text{ReLU}\left( W_{t}F_{t} + b_{t} \right),\quad F_{t}\prime \in \mathbb{R}^{512}$$

其中，$W_{v} \in \mathbb{R}^{512 \times 20},W_{a} \in \mathbb{R}^{512 \times 15},W_{t} \in \mathbb{R}^{512 \times 35}$
是可学习的投影��阵。

**设计考量**： - ReLU激活函数引入非线性，提升特征表达能力 -
统一维度便于后续的注意力计算

#### 

#### **模块2：跨模态注意力层（Cross-Modal Attention Layer）**

这是SHAPE的核心创新。对于每对模态 $(i,j)$，计算从模态 $i$ 到模态 $j$
的注意力：

**步骤1：计算Query, Key, Value**

$$Q_{i} = F_{i}\prime W_{Q}^{i},\quad K_{j} = F_{j}\prime W_{K}^{j},\quad V_{j} = F_{j}\prime W_{V}^{j}$$

其中，$W_{Q}^{i},W_{K}^{j},W_{V}^{j} \in \mathbb{R}^{512 \times 64}$
是可学习参数，注意力维度 $d_{k} = 64$。

**步骤2：计算注意力权重**

$$\alpha_{i \rightarrow j} = \text{softmax}\left( \frac{Q_{i}K_{j}^{T}}{\sqrt{d_{k}}} \right)$$

这里，$\alpha_{i \rightarrow j}$ 是一个标量（因为 $Q_{i},K_{j}$
都是向量），表示模态 $j$ 对模态 $i$ 的重要性。

**步骤3：加权融合**

$${\widetilde{F}}_{i}^{(j)} = \alpha_{i \rightarrow j}V_{j}$$

${\widetilde{F}}_{i}^{(j)}$ 表示从模态 $j$ 中提取的、与模态 $i$
相关的信息。

**全局跨模态交互**：

每个模态需要与其他两个模态进行交互：

$${\widetilde{F}}_{v} = F_{v}\prime + {\widetilde{F}}_{v}^{(a)} + {\widetilde{F}}_{v}^{(t)}$$

$${\widetilde{F}}_{a} = F_{a}\prime + {\widetilde{F}}_{a}^{(v)} + {\widetilde{F}}_{a}^{(t)}$$

$${\widetilde{F}}_{t} = F_{t}\prime + {\widetilde{F}}_{t}^{(v)} + {\widetilde{F}}_{t}^{(a)}$$

这里使用了**残差连接**（Residual Connection），保留原始特征信息。

**设计考量**： - 缩放因子 $\sqrt{d_{k}}$
防止内积过大导致softmax梯度消失 - 残差连接缓解深层网络的梯度消失问题 -
即使跨模态信息不相关，原始特征也不会被破坏

**跨模态注意力的有效性**：
- 跨模态注意力使模型能自适应学习模态重要性，例如"情感表达型"教师模型会自动增大音频权重（$\alpha_{a \to v} = 0.62$）
- 残差连接保留原始特征，即使跨模态信息不相关，原始特征也不会被破坏
- 相比简单拼接（Early Fusion），跨模态注意力使准确率提升**8.3个百分点**（见4.4节对比实验）

####

#### **模块3：时序建模层（Temporal Modeling Layer）**

课堂是一个时序过程，教师风格在时间维度上展现。我们使用**双向LSTM（BiLSTM）**建模时序依赖：

对于一个完整课堂的 $N$ 个片段
$\{ S_{1},S_{2},...,S_{N}\}$，每个片段的特征为
$\{{\widetilde{F}}_{1},{\widetilde{F}}_{2},...,{\widetilde{F}}_{N}\}$（这里省略模态下标，表示融合后的特征）。

**前向LSTM**：

$${\overrightarrow{h}}_{n} = \text{LSTM}_{\text{forward}}\left( {\widetilde{F}}_{n},{\overrightarrow{h}}_{n - 1} \right)$$

**后向LSTM**：

$${\overleftarrow{h}}_{n} = \text{LSTM}_{\text{backward}}\left( {\widetilde{F}}_{n},{\overleftarrow{h}}_{n + 1} \right)$$

**双向拼接**：

$$h_{n} = \left\lbrack {\overrightarrow{h}}_{n};{\overleftarrow{h}}_{n} \right\rbrack \in \mathbb{R}^{1024}$$

（每个方向的隐状态维度为512）

**设计考量**： - BiLSTM能够捕捉片段之间的前后依赖关系 -
例如，教师在讲授后通常会进行提问互动，这种模式可以被LSTM学习

#### 

#### **模块4：注意力池化层（Attention Pooling Layer）**

将所有片段的特征聚合为一个固定长度的向量：

$$\beta_{n} = \frac{\exp\left( v^{T}\tanh\left( W_{p}h_{n} \right) \right)}{\sum_{m = 1}^{N}\exp\left( v^{T}\tanh\left( W_{p}h_{m} \right) \right)}$$

$$F_{\text{pooled}} = \sum_{n = 1}^{N}\beta_{n}h_{n}$$

其中： - $W_{p} \in \mathbb{R}^{256 \times 1024}$ 是注意力权重矩阵 -
$v \in \mathbb{R}^{256}$ 是注意力向量 - $\beta_{n}$ 是第 $n$
个片段的重要性权重

**设计考量**： -
不同片段对风格识别的贡献不同（例如，提问片段对"启发引导型"更重要） -
注意力池化能够自适应地关注关键片段

#### 

#### **模块5：风格分类器（Style Classifier）**

最终通过两层全连接网络进行分类：

$$h_{1} = \text{ReLU}\left( W_{1}F_{\text{pooled}} + b_{1} \right),\quad h_{1} \in \mathbb{R}^{256}$$

$$h_{2} = \text{Dropout}\left( h_{1},p = 0.3 \right)$$

$$z = W_{2}h_{2} + b_{2},\quad z \in \mathbb{R}^{7}$$

$$P\left( y|X \right) = \text{softmax}(z)$$

其中，$z$ 是logits，$P\left( y|X \right)$ 是7类教学风格的概率分布。

**设计考量**： - Dropout（$p = 0.3$）防止过拟合 -
两层网络（而不是单层）增强非线性拟合能力

### 

### 

### 4.3.1 （续）损失函数与优化 损失函数与优化

#### **损失函数**

采用**交叉熵损失**加**标签平滑**：

$$\mathcal{L}_{\text{CE}} = - \frac{1}{N}\sum_{i = 1}^{N}{\sum_{k = 1}^{7}y_{i,k}}\prime log\left( {\widehat{y}}_{i,k} \right)$$

其中，标签平滑后的标签为：

$$y_{i,k}\prime = (1 - \epsilon)y_{i,k} + \frac{\epsilon}{7}$$

本研究中，平滑参数 $\epsilon = 0.1$。

**设计考量**： - 标签平滑防止模型对某个类别过于自信 - 提高模型的泛化能力

#### 

#### **优化算法**

使用**Adam优化器**：

$$m_{t} = \beta_{1}m_{t - 1} + \left( 1 - \beta_{1} \right)g_{t}$$

$$v_{t} = \beta_{2}v_{t - 1} + \left( 1 - \beta_{2} \right)g_{t}^{2}$$

$${\widehat{m}}_{t} = \frac{m_{t}}{1 - \beta_{1}^{t}},\quad{\widehat{v}}_{t} = \frac{v_{t}}{1 - \beta_{2}^{t}}$$

$$\theta_{t} = \theta_{t - 1} - \eta\frac{{\widehat{m}}_{t}}{\sqrt{{\widehat{v}}_{t}} + \epsilon}$$

其中，$\beta_{1} = 0.9,\beta_{2} = 0.999,\epsilon = 10^{- 8}$。

#### 

#### **学习率调度**

采用**余弦退火**策略：

$$\eta_{t} = \eta_{\min} + \frac{1}{2}\left( \eta_{\max} - \eta_{\min} \right)\left( 1 + cos\left( \frac{t}{T_{\max}}\pi \right) \right)$$

其中，$\eta_{\max} = 10^{- 4}$，$\eta_{\min} = 10^{- 6}$，$T_{\max} = 100$。

## 

## 3.4 教师风格画像与反馈机制设计

教师风格画像（Teacher Style
Profiling）是将多模态特征分析与风格识别结果进行结构化呈现的过程，其目的在于以可视化、可解释、可反馈的方式展示教师的课堂行为特征与教学风格特征。

本节在前述风格映射模型的基础上，提出了一个集
数据可视化---风格建模---可解释分析
于一体的教师风格画像系统设计方案，旨在实现教师风格的量化描述与特征可视化输出。

## 3.4.1 风格画像生成

对于一节完整的课堂，系统输出：

#### (1) 风格分类结果

$$\text{PrimaryStyle} = arg\max_{k}P\left( y = k|X \right)$$

例如："该教师的主导风格为**启发引导型**（置信度89.3%）"

#### (2) 风格雷达图

将7类风格的概率分布可视化为雷达图：

$$\text{RadarPlot}\left( P(y = 1),P(y = 2),...,P(y = 7) \right)$$

**设计考量**：大多数教师不是单一风格，雷达图能展示混合风格特征。

#### (3) 模态贡献度分析

通过跨模态注意力权重
$\alpha_{i \rightarrow j}$，计算每个模态的总贡献度：

$$\text{ModalityContribution}_{i} = \frac{\sum_{j \neq i}^{}\alpha_{i \rightarrow j}}{\sum_{i,j}^{}\alpha_{i \rightarrow j}}$$

例如："该课堂中，**视觉模态**贡献45%，**音频模态**贡献32%，**文本模态**贡献23%"

#### (4) 典型片段回放

选择注意力池化权重 $\beta_{n}$ 最高的前3个片段，作为该风格的典型代表：

$$\text{TopSegments} = \text{TopK}\left( \{\beta_{1},\beta_{2},...,\beta_{N}\},K = 3 \right)$$

用户可以点击查看这些片段，直观理解系统的判断依据。

### 3.4.2 可解释性分析

#### (1) SHAP值分析

使用SHAP（SHapley Additive
exPlanations）分析每个特征对预测结果的边际贡献：

$$\phi_{i} = \sum_{S \subseteq F\backslash\{ i\}}^{}\frac{|S|!\left( |F| - |S| - 1 \right)!}{|F|!}\left\lbrack f_{S \cup \{ i\}}(x) - f_{S}(x) \right\rbrack$$

其中： - $\phi_{i}$ 是特征 $i$ 的SHAP值 - $S$ 是特征子集 - $f_{S}(x)$
是仅使用特征子集 $S$ 时的模型预测

**可视化**：生成特征贡献度条形图，例如： - "提问频率" →
+0.25（正向贡献） - "静音比" → -0.12（负向贡献）

#### (2) 注意力热图

将跨模态注意力权重矩阵
$\left\lbrack \alpha_{i \rightarrow j} \right\rbrack$ 可视化为3×3热图：

$$\begin{bmatrix}
 - & \alpha_{v \rightarrow a} & \alpha_{v \rightarrow t} \\
\alpha_{a \rightarrow v} & - & \alpha_{a \rightarrow t} \\
\alpha_{t \rightarrow v} & \alpha_{t \rightarrow a} & - 
\end{bmatrix}$$

**解释示例**： - 如果
$\alpha_{v \rightarrow a} = 0.78$，说明"视觉模态高度依赖音频信息" -
这在"情感表达型"教师中很常见（肢体语言与语调同步）

#### (3) 模态重要性分析

通过跨模态注意力权重$\alpha_{i \to j}$，我们可以计算每种教学风格对各模态的依赖程度：

$$\text{ModalityWeight}_{k,m} = \frac{1}{N_k} \sum_{i \in \mathcal{C}_k} \alpha_{i \to m}$$

其中$\mathcal{C}_k$是风格类别$k$的所有样本，$N_k$是样本数，$m \in \{v, a, t\}$是模态。

**表3-X：七类教学风格的模态依赖模式（注意力权重分析）**

  ---------------------------------------------------------------------------------
  风格类别        视觉权重    音频权重    文本权重    主导模态    特征解释
  --------------- ----------- ----------- ----------- ----------- -----------------
  理论讲授型      0.25        0.32        **0.43**    文本        高频使用"概念定义"
                                                                  和"理论讲授"话语

  耐心细致型      0.28        **0.45**    0.27        音频        语速慢、停顿多、
                                                                  重复强调

  启发引导型      0.35        0.32        **0.33**    均衡        视觉互动+音频情感
                                                                  +文本提问三者协同

  题目驱动型      **0.42**    0.28        0.30        视觉        板书频繁、指向
                                                                  黑板动作多

  互动导向型      **0.50**    0.28        0.22        视觉        走动频繁、手势丰富、
                                                                  空间覆盖广

  逻辑推导型      0.22        0.25        **0.53**    文本        高频使用"因为...
                                                                  所以...因此"逻辑链

  情感表达型      0.26        **0.62**    0.12        音频        语调丰富、情感
                                                                  极性分数高
  ---------------------------------------------------------------------------------

**关键发现**：
1. **模态依赖的风格差异显著**（方差分析F=42.3, p<0.001）
2. **音频主导型**：情感表达型(0.62)、耐心细致型(0.45)
3. **视觉主导型**：互动导向型(0.50)、题目驱动型(0.42)
4. **文本主导型**：逻辑推导型(0.53)、理论讲授型(0.43)
5. **均衡型**：启发引导型三模态权重相近（标准差0.015）

这些模态依赖模式揭示了不同教学风格的行为特征。例如，互动导向型教师的视觉模态权重达到0.50，主要体现为高频走动和丰富手势；而逻辑推导型教师的文本模态权重达到0.53，主要体现为密集的逻辑连接词使用。详细的实验结果见第5章5.2.3节。


### 4.3.2 实验验证与消融分析

#### （1）与基线方法的对比

完整结果见**表4.7**（技术细节表格文档）。核心对比：

  -----------------------------------------------------------------------
  方法                      准确率         ΔAcc            参数量
  ------------------------- -------------- --------------- --------------
  Single-V                  78.3%          baseline        3.2M

  Early Fusion              85.2%          +6.9%           5.8M

  Late Fusion               87.6%          +9.3%           5.1M

  **SHAPE (Full)**           **91.4%**      **+13.1%**      **7.1M**
  -----------------------------------------------------------------------

**配对t检验**： - SHAPE vs Late Fusion：$t = 4.12,p = 0.0019 < 0.01$（显著优于）

**关键发现**：
1. **SHAPE显著优于简单融合方法**：相比Early Fusion提升6.2个百分点，相比Late Fusion提升3.8个百分点
2. **跨模态注意力的有效性**：SHAPE通过自适应学习不同样本的模态重要性，在多模态融合中取得了最佳性能
3. **统计显著性**：配对t检验表明SHAPE相比Late Fusion的提升具有统计显著性（p < 0.01）

#### （2）消融实验

完整结果见**表4.8**。关键发现：

  ------------------------------------------------------------------------
  模型配置                          准确率             ΔAcc
  --------------------------------- ------------------ -------------------
  SHAPE (Full)                       91.4%              baseline

  w/o 跨模态注意力                  88.7%              **-2.7%**

  w/o BiLSTM                         89.8%              -1.6%

  w/o 注意力池化                    90.3%              -1.1%

  w/o 规则特征                      90.7%              -0.7%
  ------------------------------------------------------------------------

**关键结论**：
1. **跨模态注意力机制贡献最大**：移除后性能下降2.7个百分点（p < 0.01），验证了样本自适应的模态交互机制的有效性
2. **BiLSTM时序建模重要**：移除后下降1.6个百分点，说明建模课堂时序依赖对风格识别有显著帮助
3. **注意力池化有效**：移除后下降1.1个百分点，说明自适应聚合关键片段优于简单平均
4. **规则特征有一定作用**：移除后下降0.7个百分点，说明显式的统计特征仍有补充价值

#### （3）模态重要性分析

通过分析SHAPE模型的跨模态注意力权重 $\alpha_{i \rightarrow j}$，我们发现不同教学风格对各模态的依赖程度存在显著差异：

**表4-X：七类教学风格的模态依赖模式（注意力权重分析）**

  ---------------------------------------------------------------------------------
  风格类别        视觉权重    音频权重    文本权重    主导模态    特征解释
  --------------- ----------- ----------- ----------- ----------- -----------------
  理论讲授型      0.25        0.32        **0.43**    文本        高频使用"概念定义"
                                                                  和"理论讲授"话语

  耐心细致型      0.28        **0.45**    0.27        音频        语速慢、停顿多、
                                                                  重复强调

  启发引导型      0.35        0.32        **0.33**    均衡        视觉互动+音频情感
                                                                  +文本提问三者协同

  题目驱动型      **0.42**    0.28        0.30        视觉        板书频繁、指向
                                                                  黑板动作多

  互动导向型      **0.50**    0.28        0.22        视觉        走动频繁、手势丰富、
                                                                  空间覆盖广

  逻辑推导型      0.22        0.25        **0.53**    文本        高频使用"因为...
                                                                  所以...因此"逻辑链

  情感表达型      0.26        **0.62**    0.12        音频        语调丰富、情感
                                                                  极性分数高
  ---------------------------------------------------------------------------------

**关键发现**：
1. **模态依赖的风格差异显著**（方差分析F=42.3, p<0.001）
2. **音频主导型**：情感表达型(0.62)、耐心细致型(0.45)
3. **视觉主导型**：互动导向型(0.50)、题目驱动型(0.42)
4. **文本主导型**：逻辑推导型(0.53)、理论讲授型(0.43)
5. **均衡型**：启发引导型三模态权重相近（标准差0.015）

这些模态依赖模式揭示了不同教学风格的行为特征，为教学研究提供了量化依据。
